[2025-03-25T14:33:25.512+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-24T03:00:00+00:00 [queued]>
[2025-03-25T14:33:25.541+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-24T03:00:00+00:00 [queued]>
[2025-03-25T14:33:25.542+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 2
[2025-03-25T14:33:25.576+0000] {taskinstance.py:1380} INFO - Executing <Task(PostgresOperator): do_work> on 2025-03-24 03:00:00+00:00
[2025-03-25T14:33:25.591+0000] {standard_task_runner.py:57} INFO - Started process 460 to run task
[2025-03-25T14:33:25.596+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'passanger_traffic', 'do_work', 'scheduled__2025-03-24T03:00:00+00:00', '--job-id', '18', '--raw', '--subdir', 'DAGS_FOLDER/passenger_traffic_dag.py', '--cfg-path', '/tmp/tmprrnwp_ee']
[2025-03-25T14:33:25.602+0000] {standard_task_runner.py:85} INFO - Job 18: Subtask do_work
[2025-03-25T14:33:25.639+0000] {logging_mixin.py:151} WARNING - /home/***/.local/lib/python3.8/site-packages/***/settings.py:195 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2025-03-25T14:33:25.720+0000] {task_command.py:415} INFO - Running <TaskInstance: passanger_traffic.do_work scheduled__2025-03-24T03:00:00+00:00 [running]> on host 55005b7b65eb
[2025-03-25T14:33:25.912+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='passanger_traffic' AIRFLOW_CTX_TASK_ID='do_work' AIRFLOW_CTX_EXECUTION_DATE='2025-03-24T03:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2025-03-24T03:00:00+00:00'
[2025-03-25T14:33:25.915+0000] {sql.py:274} INFO - Executing: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-23'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-23'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        
[2025-03-25T14:33:25.941+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-25T14:33:25.968+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-25T14:33:25.994+0000] {sql.py:418} INFO - Running statement: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-23'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-23'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        , parameters: None
[2025-03-25T14:33:26.001+0000] {sql.py:427} INFO - Rows affected: 0
[2025-03-25T14:33:26.025+0000] {taskinstance.py:1398} INFO - Marking task as SUCCESS. dag_id=passanger_traffic, task_id=do_work, execution_date=20250324T030000, start_date=20250325T143325, end_date=20250325T143326
[2025-03-25T14:33:26.063+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 0
[2025-03-25T14:33:26.103+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2025-03-25T15:13:06.313+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-24T03:00:00+00:00 [queued]>
[2025-03-25T15:13:06.338+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-24T03:00:00+00:00 [queued]>
[2025-03-25T15:13:06.341+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 2
[2025-03-25T15:13:06.402+0000] {taskinstance.py:1380} INFO - Executing <Task(PostgresOperator): do_work> on 2025-03-24 03:00:00+00:00
[2025-03-25T15:13:06.421+0000] {standard_task_runner.py:57} INFO - Started process 243 to run task
[2025-03-25T15:13:06.447+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'passanger_traffic', 'do_work', 'scheduled__2025-03-24T03:00:00+00:00', '--job-id', '10', '--raw', '--subdir', 'DAGS_FOLDER/passenger_traffic_dag.py', '--cfg-path', '/tmp/tmpd04hzvdh']
[2025-03-25T15:13:06.455+0000] {standard_task_runner.py:85} INFO - Job 10: Subtask do_work
[2025-03-25T15:13:06.507+0000] {logging_mixin.py:151} WARNING - /home/***/.local/lib/python3.8/site-packages/***/settings.py:195 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2025-03-25T15:13:06.670+0000] {task_command.py:415} INFO - Running <TaskInstance: passanger_traffic.do_work scheduled__2025-03-24T03:00:00+00:00 [running]> on host f489f841bffe
[2025-03-25T15:13:07.201+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='passanger_traffic' AIRFLOW_CTX_TASK_ID='do_work' AIRFLOW_CTX_EXECUTION_DATE='2025-03-24T03:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2025-03-24T03:00:00+00:00'
[2025-03-25T15:13:07.205+0000] {sql.py:274} INFO - Executing: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-23'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-23'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        
[2025-03-25T15:13:07.255+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-25T15:13:07.296+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-25T15:13:07.336+0000] {sql.py:418} INFO - Running statement: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-23'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-23'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        , parameters: None
[2025-03-25T15:13:07.350+0000] {sql.py:427} INFO - Rows affected: 0
[2025-03-25T15:13:07.387+0000] {taskinstance.py:1398} INFO - Marking task as SUCCESS. dag_id=passanger_traffic, task_id=do_work, execution_date=20250324T030000, start_date=20250325T151306, end_date=20250325T151307
[2025-03-25T15:13:07.469+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 0
[2025-03-25T15:13:07.546+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
