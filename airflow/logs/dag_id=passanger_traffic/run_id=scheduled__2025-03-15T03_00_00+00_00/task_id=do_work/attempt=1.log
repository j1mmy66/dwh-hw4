[2025-03-16T16:46:12.300+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T16:46:12.307+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T16:46:12.307+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 2
[2025-03-16T16:46:12.314+0000] {taskinstance.py:1380} INFO - Executing <Task(PostgresOperator): do_work> on 2025-03-15 03:00:00+00:00
[2025-03-16T16:46:12.316+0000] {standard_task_runner.py:57} INFO - Started process 254 to run task
[2025-03-16T16:46:12.318+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'passanger_traffic', 'do_work', 'scheduled__2025-03-15T03:00:00+00:00', '--job-id', '4', '--raw', '--subdir', 'DAGS_FOLDER/passenger_traffic_dag.py', '--cfg-path', '/tmp/tmpx96xyx2t']
[2025-03-16T16:46:12.319+0000] {standard_task_runner.py:85} INFO - Job 4: Subtask do_work
[2025-03-16T16:46:12.331+0000] {logging_mixin.py:151} WARNING - /home/***/.local/lib/python3.8/site-packages/***/settings.py:195 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2025-03-16T16:46:12.357+0000] {task_command.py:415} INFO - Running <TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [running]> on host 4d90099fcfcb
[2025-03-16T16:46:12.413+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='passanger_traffic' AIRFLOW_CTX_TASK_ID='do_work' AIRFLOW_CTX_EXECUTION_DATE='2025-03-15T03:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2025-03-15T03:00:00+00:00'
[2025-03-16T16:46:12.414+0000] {sql.py:274} INFO - Executing: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        
[2025-03-16T16:46:12.422+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T16:46:12.429+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T16:46:12.434+0000] {sql.py:418} INFO - Running statement: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        , parameters: None
[2025-03-16T16:46:12.446+0000] {sql.py:427} INFO - Rows affected: 0
[2025-03-16T16:46:12.453+0000] {taskinstance.py:1398} INFO - Marking task as SUCCESS. dag_id=passanger_traffic, task_id=do_work, execution_date=20250315T030000, start_date=20250316T164612, end_date=20250316T164612
[2025-03-16T16:46:12.498+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 0
[2025-03-16T16:46:12.513+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2025-03-16T17:27:18.660+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T17:27:18.665+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T17:27:18.666+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 2
[2025-03-16T17:27:18.671+0000] {taskinstance.py:1380} INFO - Executing <Task(PostgresOperator): do_work> on 2025-03-15 03:00:00+00:00
[2025-03-16T17:27:18.674+0000] {standard_task_runner.py:57} INFO - Started process 264 to run task
[2025-03-16T17:27:18.675+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'passanger_traffic', 'do_work', 'scheduled__2025-03-15T03:00:00+00:00', '--job-id', '4', '--raw', '--subdir', 'DAGS_FOLDER/passenger_traffic_dag.py', '--cfg-path', '/tmp/tmp59oci9ty']
[2025-03-16T17:27:18.677+0000] {standard_task_runner.py:85} INFO - Job 4: Subtask do_work
[2025-03-16T17:27:18.685+0000] {logging_mixin.py:151} WARNING - /home/***/.local/lib/python3.8/site-packages/***/settings.py:195 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2025-03-16T17:27:18.708+0000] {task_command.py:415} INFO - Running <TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [running]> on host d1ac8e116626
[2025-03-16T17:27:18.761+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='passanger_traffic' AIRFLOW_CTX_TASK_ID='do_work' AIRFLOW_CTX_EXECUTION_DATE='2025-03-15T03:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2025-03-15T03:00:00+00:00'
[2025-03-16T17:27:18.762+0000] {sql.py:274} INFO - Executing: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        
[2025-03-16T17:27:18.768+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T17:27:18.773+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T17:27:18.778+0000] {sql.py:418} INFO - Running statement: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        , parameters: None
[2025-03-16T17:27:18.787+0000] {sql.py:427} INFO - Rows affected: 0
[2025-03-16T17:27:18.793+0000] {taskinstance.py:1398} INFO - Marking task as SUCCESS. dag_id=passanger_traffic, task_id=do_work, execution_date=20250315T030000, start_date=20250316T172718, end_date=20250316T172718
[2025-03-16T17:27:18.816+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 0
[2025-03-16T17:27:18.828+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2025-03-16T18:05:46.621+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T18:05:46.626+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T18:05:46.626+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 2
[2025-03-16T18:05:46.632+0000] {taskinstance.py:1380} INFO - Executing <Task(PostgresOperator): do_work> on 2025-03-15 03:00:00+00:00
[2025-03-16T18:05:46.634+0000] {standard_task_runner.py:57} INFO - Started process 199 to run task
[2025-03-16T18:05:46.636+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'passanger_traffic', 'do_work', 'scheduled__2025-03-15T03:00:00+00:00', '--job-id', '4', '--raw', '--subdir', 'DAGS_FOLDER/passenger_traffic_dag.py', '--cfg-path', '/tmp/tmpktf74adh']
[2025-03-16T18:05:46.637+0000] {standard_task_runner.py:85} INFO - Job 4: Subtask do_work
[2025-03-16T18:05:46.646+0000] {logging_mixin.py:151} WARNING - /home/***/.local/lib/python3.8/site-packages/***/settings.py:195 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2025-03-16T18:05:46.668+0000] {task_command.py:415} INFO - Running <TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [running]> on host 80dc56725c49
[2025-03-16T18:05:46.717+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='passanger_traffic' AIRFLOW_CTX_TASK_ID='do_work' AIRFLOW_CTX_EXECUTION_DATE='2025-03-15T03:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2025-03-15T03:00:00+00:00'
[2025-03-16T18:05:46.718+0000] {sql.py:274} INFO - Executing: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        
[2025-03-16T18:05:46.724+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T18:05:46.730+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T18:05:46.734+0000] {sql.py:418} INFO - Running statement: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        , parameters: None
[2025-03-16T18:05:46.738+0000] {sql.py:427} INFO - Rows affected: 0
[2025-03-16T18:05:46.744+0000] {taskinstance.py:1398} INFO - Marking task as SUCCESS. dag_id=passanger_traffic, task_id=do_work, execution_date=20250315T030000, start_date=20250316T180546, end_date=20250316T180546
[2025-03-16T18:05:46.781+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 0
[2025-03-16T18:05:46.794+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2025-03-16T18:18:08.133+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T18:18:08.139+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T18:18:08.140+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 2
[2025-03-16T18:18:08.146+0000] {taskinstance.py:1380} INFO - Executing <Task(PostgresOperator): do_work> on 2025-03-15 03:00:00+00:00
[2025-03-16T18:18:08.148+0000] {standard_task_runner.py:57} INFO - Started process 194 to run task
[2025-03-16T18:18:08.150+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'passanger_traffic', 'do_work', 'scheduled__2025-03-15T03:00:00+00:00', '--job-id', '4', '--raw', '--subdir', 'DAGS_FOLDER/passenger_traffic_dag.py', '--cfg-path', '/tmp/tmpxfannz4r']
[2025-03-16T18:18:08.152+0000] {standard_task_runner.py:85} INFO - Job 4: Subtask do_work
[2025-03-16T18:18:08.162+0000] {logging_mixin.py:151} WARNING - /home/***/.local/lib/python3.8/site-packages/***/settings.py:195 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2025-03-16T18:18:08.184+0000] {task_command.py:415} INFO - Running <TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [running]> on host 646f6f6fd47c
[2025-03-16T18:18:08.233+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='passanger_traffic' AIRFLOW_CTX_TASK_ID='do_work' AIRFLOW_CTX_EXECUTION_DATE='2025-03-15T03:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2025-03-15T03:00:00+00:00'
[2025-03-16T18:18:08.234+0000] {sql.py:274} INFO - Executing: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        
[2025-03-16T18:18:08.240+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T18:18:08.246+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T18:18:08.250+0000] {sql.py:418} INFO - Running statement: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        , parameters: None
[2025-03-16T18:18:08.254+0000] {sql.py:427} INFO - Rows affected: 0
[2025-03-16T18:18:08.260+0000] {taskinstance.py:1398} INFO - Marking task as SUCCESS. dag_id=passanger_traffic, task_id=do_work, execution_date=20250315T030000, start_date=20250316T181808, end_date=20250316T181808
[2025-03-16T18:18:08.292+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 0
[2025-03-16T18:18:08.304+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2025-03-16T18:28:04.617+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T18:28:04.621+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T18:28:04.622+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 2
[2025-03-16T18:28:04.627+0000] {taskinstance.py:1380} INFO - Executing <Task(PostgresOperator): do_work> on 2025-03-15 03:00:00+00:00
[2025-03-16T18:28:04.630+0000] {standard_task_runner.py:57} INFO - Started process 194 to run task
[2025-03-16T18:28:04.631+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'passanger_traffic', 'do_work', 'scheduled__2025-03-15T03:00:00+00:00', '--job-id', '4', '--raw', '--subdir', 'DAGS_FOLDER/passenger_traffic_dag.py', '--cfg-path', '/tmp/tmp3e6uo7mb']
[2025-03-16T18:28:04.633+0000] {standard_task_runner.py:85} INFO - Job 4: Subtask do_work
[2025-03-16T18:28:04.642+0000] {logging_mixin.py:151} WARNING - /home/***/.local/lib/python3.8/site-packages/***/settings.py:195 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2025-03-16T18:28:04.665+0000] {task_command.py:415} INFO - Running <TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [running]> on host c29f0f3e1140
[2025-03-16T18:28:04.715+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='passanger_traffic' AIRFLOW_CTX_TASK_ID='do_work' AIRFLOW_CTX_EXECUTION_DATE='2025-03-15T03:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2025-03-15T03:00:00+00:00'
[2025-03-16T18:28:04.716+0000] {sql.py:274} INFO - Executing: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        
[2025-03-16T18:28:04.722+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T18:28:04.729+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T18:28:04.734+0000] {sql.py:418} INFO - Running statement: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        , parameters: None
[2025-03-16T18:28:04.738+0000] {sql.py:427} INFO - Rows affected: 0
[2025-03-16T18:28:04.745+0000] {taskinstance.py:1398} INFO - Marking task as SUCCESS. dag_id=passanger_traffic, task_id=do_work, execution_date=20250315T030000, start_date=20250316T182804, end_date=20250316T182804
[2025-03-16T18:28:04.774+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 0
[2025-03-16T18:28:04.786+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2025-03-16T19:54:49.610+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T19:54:49.615+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T19:54:49.615+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 2
[2025-03-16T19:54:49.621+0000] {taskinstance.py:1380} INFO - Executing <Task(PostgresOperator): do_work> on 2025-03-15 03:00:00+00:00
[2025-03-16T19:54:49.624+0000] {standard_task_runner.py:57} INFO - Started process 194 to run task
[2025-03-16T19:54:49.625+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'passanger_traffic', 'do_work', 'scheduled__2025-03-15T03:00:00+00:00', '--job-id', '4', '--raw', '--subdir', 'DAGS_FOLDER/passenger_traffic_dag.py', '--cfg-path', '/tmp/tmpasje_zfl']
[2025-03-16T19:54:49.627+0000] {standard_task_runner.py:85} INFO - Job 4: Subtask do_work
[2025-03-16T19:54:49.635+0000] {logging_mixin.py:151} WARNING - /home/***/.local/lib/python3.8/site-packages/***/settings.py:195 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2025-03-16T19:54:49.657+0000] {task_command.py:415} INFO - Running <TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [running]> on host 01a81fd2cf97
[2025-03-16T19:54:49.711+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='passanger_traffic' AIRFLOW_CTX_TASK_ID='do_work' AIRFLOW_CTX_EXECUTION_DATE='2025-03-15T03:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2025-03-15T03:00:00+00:00'
[2025-03-16T19:54:49.712+0000] {sql.py:274} INFO - Executing: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        
[2025-03-16T19:54:49.719+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T19:54:49.726+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T19:54:49.731+0000] {sql.py:418} INFO - Running statement: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        , parameters: None
[2025-03-16T19:54:49.735+0000] {sql.py:427} INFO - Rows affected: 0
[2025-03-16T19:54:49.742+0000] {taskinstance.py:1398} INFO - Marking task as SUCCESS. dag_id=passanger_traffic, task_id=do_work, execution_date=20250315T030000, start_date=20250316T195449, end_date=20250316T195449
[2025-03-16T19:54:49.766+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 0
[2025-03-16T19:54:49.778+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2025-03-16T20:03:56.715+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T20:03:56.721+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T20:03:56.722+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 2
[2025-03-16T20:03:56.730+0000] {taskinstance.py:1380} INFO - Executing <Task(PostgresOperator): do_work> on 2025-03-15 03:00:00+00:00
[2025-03-16T20:03:56.732+0000] {standard_task_runner.py:57} INFO - Started process 194 to run task
[2025-03-16T20:03:56.734+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'passanger_traffic', 'do_work', 'scheduled__2025-03-15T03:00:00+00:00', '--job-id', '4', '--raw', '--subdir', 'DAGS_FOLDER/passenger_traffic_dag.py', '--cfg-path', '/tmp/tmphlz17xyh']
[2025-03-16T20:03:56.736+0000] {standard_task_runner.py:85} INFO - Job 4: Subtask do_work
[2025-03-16T20:03:56.745+0000] {logging_mixin.py:151} WARNING - /home/***/.local/lib/python3.8/site-packages/***/settings.py:195 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2025-03-16T20:03:56.769+0000] {task_command.py:415} INFO - Running <TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [running]> on host 16ae585d7ab0
[2025-03-16T20:03:56.819+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='passanger_traffic' AIRFLOW_CTX_TASK_ID='do_work' AIRFLOW_CTX_EXECUTION_DATE='2025-03-15T03:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2025-03-15T03:00:00+00:00'
[2025-03-16T20:03:56.819+0000] {sql.py:274} INFO - Executing: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        
[2025-03-16T20:03:56.825+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T20:03:56.831+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T20:03:56.836+0000] {sql.py:418} INFO - Running statement: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        , parameters: None
[2025-03-16T20:03:56.840+0000] {sql.py:427} INFO - Rows affected: 0
[2025-03-16T20:03:56.846+0000] {taskinstance.py:1398} INFO - Marking task as SUCCESS. dag_id=passanger_traffic, task_id=do_work, execution_date=20250315T030000, start_date=20250316T200356, end_date=20250316T200356
[2025-03-16T20:03:56.875+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 0
[2025-03-16T20:03:56.889+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2025-03-16T20:12:20.657+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T20:12:20.663+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T20:12:20.663+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 2
[2025-03-16T20:12:20.669+0000] {taskinstance.py:1380} INFO - Executing <Task(PostgresOperator): do_work> on 2025-03-15 03:00:00+00:00
[2025-03-16T20:12:20.672+0000] {standard_task_runner.py:57} INFO - Started process 194 to run task
[2025-03-16T20:12:20.674+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'passanger_traffic', 'do_work', 'scheduled__2025-03-15T03:00:00+00:00', '--job-id', '4', '--raw', '--subdir', 'DAGS_FOLDER/passenger_traffic_dag.py', '--cfg-path', '/tmp/tmpzbwj4uoj']
[2025-03-16T20:12:20.675+0000] {standard_task_runner.py:85} INFO - Job 4: Subtask do_work
[2025-03-16T20:12:20.684+0000] {logging_mixin.py:151} WARNING - /home/***/.local/lib/python3.8/site-packages/***/settings.py:195 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2025-03-16T20:12:20.709+0000] {task_command.py:415} INFO - Running <TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [running]> on host b70acf7f0e92
[2025-03-16T20:12:20.761+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='passanger_traffic' AIRFLOW_CTX_TASK_ID='do_work' AIRFLOW_CTX_EXECUTION_DATE='2025-03-15T03:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2025-03-15T03:00:00+00:00'
[2025-03-16T20:12:20.762+0000] {sql.py:274} INFO - Executing: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        
[2025-03-16T20:12:20.768+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T20:12:20.774+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T20:12:20.779+0000] {sql.py:418} INFO - Running statement: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        , parameters: None
[2025-03-16T20:12:20.783+0000] {sql.py:427} INFO - Rows affected: 0
[2025-03-16T20:12:20.790+0000] {taskinstance.py:1398} INFO - Marking task as SUCCESS. dag_id=passanger_traffic, task_id=do_work, execution_date=20250315T030000, start_date=20250316T201220, end_date=20250316T201220
[2025-03-16T20:12:20.817+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 0
[2025-03-16T20:12:20.831+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2025-03-16T20:25:01.770+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T20:25:01.776+0000] {taskinstance.py:1157} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [queued]>
[2025-03-16T20:25:01.776+0000] {taskinstance.py:1359} INFO - Starting attempt 1 of 2
[2025-03-16T20:25:01.783+0000] {taskinstance.py:1380} INFO - Executing <Task(PostgresOperator): do_work> on 2025-03-15 03:00:00+00:00
[2025-03-16T20:25:01.786+0000] {standard_task_runner.py:57} INFO - Started process 223 to run task
[2025-03-16T20:25:01.788+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'passanger_traffic', 'do_work', 'scheduled__2025-03-15T03:00:00+00:00', '--job-id', '4', '--raw', '--subdir', 'DAGS_FOLDER/passenger_traffic_dag.py', '--cfg-path', '/tmp/tmpo6bn94kz']
[2025-03-16T20:25:01.789+0000] {standard_task_runner.py:85} INFO - Job 4: Subtask do_work
[2025-03-16T20:25:01.799+0000] {logging_mixin.py:151} WARNING - /home/***/.local/lib/python3.8/site-packages/***/settings.py:195 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2025-03-16T20:25:01.825+0000] {task_command.py:415} INFO - Running <TaskInstance: passanger_traffic.do_work scheduled__2025-03-15T03:00:00+00:00 [running]> on host 711ad4f92c48
[2025-03-16T20:25:01.881+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='passanger_traffic' AIRFLOW_CTX_TASK_ID='do_work' AIRFLOW_CTX_EXECUTION_DATE='2025-03-15T03:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2025-03-15T03:00:00+00:00'
[2025-03-16T20:25:01.882+0000] {sql.py:274} INFO - Executing: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        
[2025-03-16T20:25:01.890+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T20:25:01.897+0000] {base.py:73} INFO - Using connection ID '***_dwh' for task execution.
[2025-03-16T20:25:01.902+0000] {sql.py:418} INFO - Running statement: 
        WITH arrivals AS (
          SELECT
            date(actual_arrival) AS flight_date,
            arrival_airport AS airport_code,
            departure_airport AS linked_airport_code,
            count(*) AS flights_in,
            count(ltf.hub_ticket_id) AS passengers_in
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_arrival IS NOT NULL
            AND date(actual_arrival) = DATE '2025-03-14'
          GROUP BY date(actual_arrival), arrival_airport, departure_airport
        ),
        departures AS (
          SELECT
            date(actual_departure) AS flight_date,
            departure_airport AS airport_code,
            arrival_airport AS linked_airport_code,
            count(*) AS flights_out,
            count(ltf.hub_ticket_id) AS passengers_out
          FROM dwh_detailed.sat_flights f
          LEFT JOIN dwh_detailed.link_ticket_flights ltf
            ON f.hub_flight_id = ltf.hub_flight_id
          WHERE actual_departure IS NOT NULL
            AND date(actual_departure) = DATE '2025-03-14'
          GROUP BY date(actual_departure), departure_airport, arrival_airport
        )
        INSERT INTO presentation.passenger_traffic
        SELECT
          now() AS created_at,
          COALESCE(a.flight_date, d.flight_date) AS flight_date,
          COALESCE(a.airport_code, d.airport_code) AS airport_code,
          COALESCE(a.linked_airport_code, d.linked_airport_code) AS linked_airport_code,
          COALESCE(a.flights_in, 0) AS flights_in,
          COALESCE(d.flights_out, 0) AS flights_out,
          COALESCE(a.passengers_in, 0) AS passengers_in,
          COALESCE(d.passengers_out, 0) AS passengers_out
        FROM arrivals a
        FULL OUTER JOIN departures d
          ON a.flight_date = d.flight_date
          AND a.airport_code = d.airport_code
          AND a.linked_airport_code = d.linked_airport_code;
        , parameters: None
[2025-03-16T20:25:01.904+0000] {sql.py:427} INFO - Rows affected: 0
[2025-03-16T20:25:01.911+0000] {taskinstance.py:1398} INFO - Marking task as SUCCESS. dag_id=passanger_traffic, task_id=do_work, execution_date=20250315T030000, start_date=20250316T202501, end_date=20250316T202501
[2025-03-16T20:25:01.928+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 0
[2025-03-16T20:25:01.941+0000] {taskinstance.py:2776} INFO - 0 downstream tasks scheduled from follow-on schedule check
